# Example Pulse Chain Plugin

Pulse provides an Agent architecture that allows chains to be run in a distributed environment. Each chain is made up
of a collection of steps, with each step calling a Chain Plugin to perform some work, for example to run a build
tool, perform some static analysis or trigger a deployment. The possibilities of what a chain can do are only limited
by the Chain Plugins, and if there are no plugins that do what you want, it is possible to write a new plugin using
the Pulse Plugin API.

The project contains a simple example of a Pulse Chain Plugin that searches the files contained in the Agent workspace
for the words provided in the step configuration.

## Building the example

The example is provided as a maven project and requires a copy of Maven and a JDK to build it. At the time of publication
Maven 3.x and a JDK 8.x is required. Once these are installed, the plugin can simply be built using:

````
mvn clean install
````

Once the plugin has been successfully built, you will find a file named `example-chain-plugin-word-detector.spar` in the
target directory. This is the plugin packaged as a `spar` file, and ready to be installed into Pulse. 

## Running the example

To aid in development and to make it easy to debug plugins, it is possible to run a Pulse Agent on the command line, pointing
it to the `spar` file generated by the build, a configuration file, and a directory of code to be passed to the plugin to work on.

Before you start, it is worth switching the *agent* to run as a single process rather than spawning another process to run the chain. This
can be done by adding the line `agent.development.worker.mode=inprocess` to the configuration file in `c:\pulse-agent-install\conf\config.properties`

Assuming an agent installed in `c:\pulse-agent-install`, and the example plugin located in `c:\example-chain-plugin-word-detector` you would
use the following command to run the plugin.

````
java "-Duser.dir=c:\pulse-agent-install"
     "-Dlogback.configurationFile=c:\pulse-agent-install\conf\agent-logback.xml"
     -classpath "c:\pulse-agent-install\lib\*" com.serena.starlight.agent.AgentEntryPoint 
     "config:c:\pulse-agent-install\conf\config.properties" 
     "run:.\example-chain.json"  
     "result:.\chainresult.json" 
     "install:.\target\example-chain-plugin-word-detector.spar"
     "workspace:c:\directory_to_be_processed"
````

*Note: Although the example is on multiple lines, it should run as a single line. You might find it simpler to create a batch file with the command.*

The command will take a *chain definition* file  called `chainrun.json` in the current directory and use that to configure the plugin
and the result of the run will be output to `chainresult.json`. Examples of these files are located in the top level directory of the example plugin.





